{
  "name": "07. Islands Optimization: Reducing Hydration Payload",
  "description": "Best practices for minimizing island props JSON size and reducing hydration scope using children pattern for better client-side performance.",
  "content": "---\ndescription: Optimizing the use of islands\nsince: 1.0.0\n---\n\n## Summary\n\n> An island is a component that is interactive and will be hydrated on the\n> client side. The server sends all the data from the island's `props` for\n> hydration, and the browser needs time to process and render these islands.\n>\n> Therefore, it is important to take some precautions when using islands:\n>\n> 1. Minimize the amount of props to be sent/used for an island\n> 2. Make an island only what is necessary, remembering to use `children` for\n>    internal elements that do not need hydration.\n\n## Reducing the size of the props JSON sent to islands\n\nWhen loading data from external APIs using [Loaders](https://deco.cx/docs/en/concepts/loader)\nand sending them to the [Section](https://deco.cx/docs/en/concepts/section), it is possible\nthat the size of the payload negatively impacts the performance of the site. The\nimpact occurs both in the initial loading time and in the\n[hydration](https://blog.saeloun.com/2021/12/16/hydration/), where the page is\n\"initialized\" in the browser to make it interactive (using `useEffect`,\n`useSignal`, etc...). You can view the size of the final JSON through the\n**Performance** tab of one of your site pages in the Deco CMS.\n\n<Frame><img width=\"640\" alt=\"Performance information of a page\" src=\"https://deco.cx/docs/performance/performance-tab.png\"/></Frame>\n\nWhen the JSON size exceeds ~500kb, it is likely that the UI does not need the\ncomplete data, but rather some part of it (or a computation based on other\nvalues). To reduce this size and improve page performance, it is possible to\n**filter the data** in the Loader so that only the necessary data is passed to\nthe UI.\n\n### Reducing data sent to islands\n\nIn this first example, we will show how to avoid sending too much data to an\nisland. Let's say there is a component called ProductCard that receives the\nentire JSON of a product.\n\n```tsx\nimport Image from \"apps/website/components/Image.tsx\";\n\nexport default function ProductCard({ product }: Props) {\n  return (\n    <div>\n      <Image src={product.image} width=\"100\" height=\"100\" />\n    </div>\n  );\n}\n```\n\nIn it, you want to include an\n[Island](https://fresh.deno.dev/docs/concepts/islands) to create the buy button.\n\n```tsx\nimport BuyButton from \"$store/components/ui\";\nimport Image from \"apps/website/components/Image.tsx\";\n\nexport default function ProductCard({ product }: Props) {\n  return (\n    <div>\n      <Image src={product.image} width=\"100\" height=\"100\" />\n      <BuyButton />\n    </div>\n  );\n}\n```\n\nIt is possible that this BuyButton needs some product information in order to\nadd it to the cart.\n\nThis is where we need to be careful about the amount of data sent to the Island.\nFor example, it is very likely that the buy button does not need to receive\nimage data.\n\nThe ideal approach is to send only the necessary data.\n\n> ❌ Inappropriate approach\n\n```tsx\nimport BuyButton from \"$store/components/ui\";\nimport Image from \"apps/website/components/Image.tsx\";\n\nexport default function ProductCard({ product }: Props) {\n  return (\n    <div>\n      <Image src={product.image} width=\"100\" height=\"100\" />\n      <BuyButton product={product} />\n    </div>\n  );\n}\n```\n\n> ✅ Correct approach\n\n```tsx\nimport BuyButton from \"$store/components/ui\";\nimport Image from \"apps/website/components/Image.tsx\";\n\nexport default function ProductCard({ product }: Props) {\n  return (\n    <div>\n      <Image src={product.image} width=\"100\" height=\"100\" />\n      <BuyButton id={product.id} seller={product.seller} />\n    </div>\n  );\n}\n```\n\nThe correct approach sends only the ID and Seller data, which in the example are\nthe only ones needed in the Island.\n\nThus, during hydration, the JSON that the Island will load will not be as large.\n\n### Reducing the scope of an island\n\nAn island and its components will all be hydrated on the client side in order to\noperate. This means that for all defined elements of the island, they will be\nrecursively hydrated.\n\nIt is possible to reduce the scope of the island by passing any internal\nelements as `children` of the island.\n\n> ❌ Inappropriate approach\n\nIn the example below, we create an island that interacts with `localStorage` to\nset a title for a gallery of items. In the example below, both the gallery props\nwill be passed to hydrate the `TitleContainer` and will also be passed to\nhydrate the `Gallery`.\n\n```tsx\nimport { computed } from \"@preact/signals\";\nimport { IS_BROWSER } from \"$fresh/runtime.ts\";\nimport type { GalleryProps } from \"../components/Gallery.tsx\";\nimport { Gallery } from \"../components/Gallery.tsx\";\n\nexport default function TitleContainer(\n  { galleryProps }: { galleryProps: GalleryProps },\n) {\n  const title = computed(() => {\n    IS_BROWSER ? localStorage.getItem(\"title\") : \"Loading...\";\n  });\n\n  return (\n    <div>\n      <h1>{title}</h1>\n      <Gallery {...galleryProps} />\n    </div>\n  );\n}\n```\n\n> ✅ Correct approach\n\nHowever, if the `Gallery` is passed as children to the island, it will be\nrendered, serialized, and not hydrated! For the `TitleContainer`, the `children`\nis pre-rendered HTML ready to be displayed, and therefore it is not an island\nitself.\n\n```tsx\nimport { computed } from \"@preact/signals\";\nimport type { ComponentChildren } from \"preact\";\nimport { IS_BROWSER } from \"$fresh/runtime.ts\";\n\nexport default function TitleContainer(\n  { children }: { children: ComponentChildren },\n) {\n  const title = computed(() => {\n    IS_BROWSER ? localStorage.getItem(\"title\") : \"Loading...\";\n  });\n\n  return (\n    <div>\n      <h1>{title}</h1>\n      {children}\n    </div>\n  );\n}\n```\n\nUso do title container (em uma section, por exemplo):\n\n```tsx\n//...\n<TitleContainer>\n    <Gallery {...galleryProps}>\n</TitleContainer>\n//...\n```\n"
}