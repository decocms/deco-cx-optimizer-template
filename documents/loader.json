{
  "name": "18. Loader Concept: Data Fetching Functions",
  "description": "Understanding Loaders as TypeScript functions for fetching and transforming data from external sources, with configurable props and reusability patterns.",
  "content": "---\ndescription: A Loader in deco.cx is a function that returns data needed for a Site.\nsince: 1.0.0\n---\n\nA **Loader** in _deco.cx_ is a Typescript function that returns data typically\nneeded in a [Section](https://deco.cx/docs/en/concepts/section). These functions are executed\nbefore page renders, and their main purpose is to **fetch data from external\nsources**, transform it if necessary, and **provide it to the site Sections that\nneed it.** Loaders can be used to fetch data from APIs, databases, or any other\nexternal source. They live locally on the `/loaders/` folder of your project,\nbut it's also possible to\n[Installing apps](https://deco.cx/docs/en/getting-started/installing-an-app) that contain\nloaders.\n\n{/* TODO: Update folder name after new engine */}\n\nIn addition to fetching data, Loaders in _deco.cx_ **can also export a\nTypescript Props type,** which allows them to be configured in the\n[Admin](https://deco.cx/admin) just like [Sections](https://deco.cx/docs/en/concepts/section).\nThis means that business users can configure details about how the Loader will\noperate, such as **setting up filters or passing parameters to APIs.** By making\nLoaders configurable in this way, it becomes easier to manage the data flowing\ninto Sections and ensure that the Site is displaying the right information to\nvisitors.\n\nOne other great benefit of Loaders in _deco.cx_ is that **multiple loaders can\nreturn the same data type**. This allows [Sections](https://deco.cx/docs/en/concepts/section)\nthat receive, for example, an array of canonical Product to get data from\ndifferent Loaders, depending on the user's configuration. This means that UIs\ncan be reused across [Sites](https://deco.cx/docs/en/concepts/site) or across teams, making it\neasier to manage and scale your project.\n\n> All Sections for ecommerce stores created by _deco.cx_ in the\n> [Storefront](https://github.com/deco-sites/storefront) start use a canonical\n> Product type, and also every Loader that connects to ecommerce providers's\n> APIs. This means that you can reuse the same UI to show data from different\n> places, depending on the configuration.\n\n<Frame><img width=\"1259\" alt=\"image\" src=\"https://user-images.githubusercontent.com/18706156/224897214-a45b2731-5799-4007-8084-a8a772ddf5d2.png\"/></Frame>\n\n## Example Code\n\nThis is the implementation of the `shopify/loaders/ProductList.ts` Loader:\n\n```tsx\nimport type { Product } from \"../../commerce/types.ts\";\nimport { AppContext } from \"../../shopify/mod.ts\";\nimport { ListProducts } from \"../utils/storefront/queries.ts\";\nimport {\n  ListProductsQuery,\n  ListProductsQueryVariables,\n} from \"../utils/storefront/storefront.graphql.gen.ts\";\nimport { toProduct } from \"../utils/transform.ts\";\n\nexport interface Props {\n  /** @description search term to use on search */\n  query: string;\n  /** @description total number of items to display */\n  count: number;\n}\n\n/**\n * @title Shopify Integration\n * @description Product List loader\n */\nconst loader = async (\n  props: Props,\n  _req: Request,\n  ctx: AppContext,\n): Promise<Product[] | null> => {\n  const { storefront } = ctx;\n\n  const count = props.count ?? 12;\n  const query = props.query || \"\";\n\n  const data = await storefront.query<\n    ListProductsQuery,\n    ListProductsQueryVariables\n  >({\n    variables: { first: count, query },\n    ...ListProducts,\n  });\n\n  // Transform Shopify product format into schema.org's compatible format\n  // If a property is missing from the final `products` array you can add\n  // it in here\n  const products = data?.products.nodes.map((p) =>\n    toProduct(p, p.variants.nodes[0], new URL(_req.url))\n  );\n\n  return products ?? [];\n};\n\nexport default loader;\n```\n\n[Source](https://github.com/deco-cx/apps/blob/3e337b6b2996d7ecd72db34174896638c92f8811/shopify/loaders/ProductList.ts#L1)\n\n## Recommended Reading\n\n- [Fetching data from APIs](https://deco.cx/docs/en/developing-guide/fetching-data)\n- [Client-side function invocation](https://deco.cx/docs/en/developing-capabilities/islands/fetching-data-client)\n"
}